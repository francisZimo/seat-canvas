{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/wangyongju/Documents/个人资料/seat-canvas/pages/index/index.vue?9236","webpack:////Users/wangyongju/Documents/个人资料/seat-canvas/pages/index/index.vue?ea06","webpack:////Users/wangyongju/Documents/个人资料/seat-canvas/pages/index/index.vue?8a91","uni-app:///pages/index/index.vue","webpack:////Users/wangyongju/Documents/个人资料/seat-canvas/pages/index/index.vue?2074","webpack:////Users/wangyongju/Documents/个人资料/seat-canvas/pages/index/index.vue?20a8"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","canvasContainerBox","width","height","scaleBase","scale","preScale","baseXPoint","baseYPoint","canvasClass","maxScale","minScale","scaleStep","offset","x","y","curOffset","mousePos","isLoading","widthRatio","heightRatio","startX","startY","canvasStyle","tempStyle","imgUrl","seatPosition","isShowSeatImg","curSelectSeat","thumbnailInfo","top","left","changeWidth","changeHeight","innerBoxInitInfo","thumbnailStyle","isShowCanvas","visibleAreaStyle","canvasInitInfo","thumbnailScale","seatBoxHeight","isTouchMoving","canvasType","tempFilePath","isShowTemp","boundary","right","bottom","isCancelDraw","diffOffsetY","onLoad","onReady","mounted","uni","methods","exportThumbnail","canvasId","success","initData","rectCanvas","calculateBoundingRectangle","minX","minY","maxX","maxY","init","setTimeout","startTargetCanvas","ctx","draw","console","changeStyle","drawThumbnail","isOverLayout","zoomIn","zoomOut","zoom","clearCanvas","reset","clear","userDraw","seatInfoList","type","isDraw","drawRectangle","context","payload","drawText","name","drawCircle","radius","isFill","info","drawPolygon","points","handleRegion","handleSeat","c","isSelect","angle","circleInstance","config","shapeInfo","circleInfo","handleShapeRegion","handleStage","handleRow","onCanvasTouchStart","initialDistance","onCanvasTouchMove","offsetX","offsetY","onCanvasTouchEnd"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACsC;;;AAG1F;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAm0B,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACiDv1B;AAGA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AATA;AACA;AACA;;AASA;AACA;AAAA,eACA;EACAC;IACA;MACAC;QAAA;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;QAAA;QACAC;QACAC;MACA;MACAC;QAAA;QACAF;QACAC;MACA;MACAE;QAAA;QACAH;QACAC;MACA;MACAG;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;QAAA;QACA3B;QACAC;QACA2B;QACAC;QACAC;QACAC;MACA;MACAC;QAAA;QACAhC;QACAC;MACA;MACAgC;MAAA;MACAC;MACAC;MAAA;MACAC;QAAA;QACApC;QACAC;MACA;MACAoC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;QACAd;QACAe;QACAhB;QACAiB;MACA;MACAC;MACAC;IAEA;EACA;EACAC,2BAEA;EACAC,6BAEA;EAEAC;IAAA;IAEA;IACAC;MACA;MACA;MACA;QACAnD;QACAC;MACA;MACA;IACA;EACA;EACAmD;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;MAEAF;QACAG;QACAC;UACA;UAEA;UACA;UACA;UACA,2CACAvD;UACA;YACAA;YACAC;UACA;QAEA;MACA;IACA;IAEA;IACAuD;MACA;MACA;MACA,IACA5C,IAIA6C,WAJA7C;QACAC,IAGA4C,WAHA5C;QACAb,QAEAyD,WAFAzD;QACAC,SACAwD,WADAxD;MAEA;MACA;MACA;MACAE;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAuD;MACA;MACA;MACA;MACA;MACA;MACA;QACA;QACA;QACA;QACA;UACA;QAAA;QAEA;UACA;QAAA;QAGA;QACA;QACAC;QACAC;QACAC;QACAC;MACA;MAEA;MACA;MACA;QACAlD;QACAC;QACAb;QACAC;MACA;IACA;IACA;IACA8D;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACAC;kBACA;kBACA;kBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAC;MACA;MACA;MACA;MACA;MACA;MAEA;QACApC;QACAe;QACAhB;QACAiB;MACA;MACA;QACA7C;QACAC;MACA;MACA;MACA;MAGA;MACA;MACA,uCACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAiE;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;MAEA;QACA;QACA;QACA;QACA;UACA;YACAC;YACA,6FACAjE,QACA,gBACA,gBACAH,uBACAC;YACA;UAEA;YACAmE;YACA;UACA;QACA;UACAA;UACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;QACA;QACA;QACA;MACA;MAEA;MACA;QACA;MACA;MACA;QACA;MACA;MACA;QACA;MACA;MACA;QACA;MACA;MACA,mCACA;MACA,kCACAC;IAEA;IACA;IACAC;MACA;MACA,0BAGA;QAFAtE;QACAC;MAEA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;IAEA;IAEAsE;MACA,2BAOA;QANA1C;QACAD;QACAE;QACAC;QACA/B;QACAC;MAEA;QACA4B;QACAe;QACAhB;QACAiB;MACA;MACA;IACA;IAEA;IACA2B;MACA;MACA;MACA;QACA;QACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MAEA;QACA;QACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;QACAjE;QACAC;MACA;MACA;QACAD;QACAC;MACA;MACA;QAAA;QACAD;QACAC;MACA;IACA;IAEA;IACAiE;MAAA;MAAA;MACAC;QACAX;QACA;QACA;UACAY;QACA;QACA;UACAA;QACA;QACA;UACAA;QACA;QACA;UACAA;QACA;QACA;UACAA;QACA;QACA;UACA;QACA;QAEA;UACA;QACA;QAEA;UACA;QACA;QAEA;UACA;QACA;QACA;UACA;QACA;MACA;MACAC;MACAb;IACA;IACA;IACAc;MACA,IACAC,UAKAC,QALAD;QACAvE,IAIAwE,QAJAxE;QACAC,IAGAuE,QAHAvE;QACAb,QAEAoF,QAFApF;QACAC,SACAmF,QADAnF;MAEAkF;MACAA;MACAA;MACAA;MACAA;IAEA;IACA;IACAE;MACA,IACAF,UAIAC,QAJAD;QACAvE,IAGAwE,QAHAxE;QACAC,IAEAuE,QAFAvE;QACAyE,OACAF,QADAE;MAEAH;MACAA;MACAA;MACAA;MACAA;MACAA;IAEA;IACA;IACAI;MACA,IACAJ,UAMAC,QANAD;QACAvE,IAKAwE,QALAxE;QACAC,IAIAuE,QAJAvE;QACA2E,SAGAJ,QAHAI;QACAC,SAEAL,QAFAK;QACAC,OACAN,QADAM;MAEA;MACAP;MACAA;MACAA;MACA;QAEA;QACAA;QACAA;QACAA;QACAA;QACA;QACA;QACAA;MACA;MACAA;IAEA;IACA;IACAQ;MACA,IACAR,UAEAO,KAFAP;QACAS,SACAF,KADAE;MAEA;QACA;MACA;MACAT;MACAA;MAEA;QACAA;MACA;MACAA;MACAA;MACAA;IAEA;IACAU;MACA;MACA;MACA;QACA;UACAV;UACAvE;UACAC;UACAb;UACAC;QACA;MACA;MAEA;QACA;UACAkF;UACAvE;UACAC;UACA2E;UACAC;QACA;MACA;IACA;IACA;IACAK;MAAA;MACA;MACA;QACAN;QACA5E;QACAC;QACA6E;UACAK;UACAC;UACAC;QACA;QACAR;MACA;MACA;QACA;QACAS;UACA;UACA;UACA;UACA;YACA;cACA;gBACA;gBACA;kBACA9B;kBACAW;kBACA;oBACA,IACAoB,SACAC,UADAD;oBAEA;oBACA;oBACA,6EACAhG;oBACA;oBACA;kBAEA;oBACA;kBACA;gBAEA;kBACA4E;gBACA;cACA;YACA;YAEA;UACA;QACA;MACA;QACA;QACAsB;QACA;MAEA;IAEA;IACAC;MAAA;MACA;MACA;MACA;QACA;UACA1F;UACAC;QACA;MACA;MACA;QACAsE;QACAS;MACA;IACA;IACAW;MACA;QACApB;QACAvE;QACAC;QACAb;QACAC;MACA;MACA;MACA;QACAkF;QACAG;QACA1E;QACAC;MACA;MACA;IACA;IACA;IACA2F;MACA;MACA;MACA;QACArB;QACAvE;QACAC;QACAyE;MACA;MACA;IACA;IACAmB;MACA;MACA;QACA;QACA;QACA;QACAC;MACA;QACA;QACA;MACA;IAEA;IACAC;MACA;MACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;QAEA;UACA;QACA;UACA;QACA;QAEAD;MAEA;QACA;QACA;UACA;QACA;QAEA;QACA;QAEA;QACA;QAGA;QACA;QAIA;UACAE;QACA;QACA;UACAA;QACA;QAEA;UACAC;QACA;QACA;UACAA;QACA;QACA;QACA;QAEA;MACA;IACA;IACAC;MAEA;MACA;QACA;MACA;MACA;QACA;QACA;QACA1C;QACA;MACA;MACA;MACA;QACAtD;QACAX;MACA;IAGA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AClyBA;AAAA;AAAA;AAAA;AAA0jD,CAAgB,07CAAG,EAAC,C;;;;;;;;;;;ACA9kD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/index/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/index/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=57280228&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=57280228&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"57280228\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=57280228&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<cover-view v-if=\"isLoading\" class=\"loading-mask \">\r\n\t\t\t<cover-view class=\"loading-text\">加载中...</cover-view>\r\n\t\t</cover-view>\r\n\t\t<view class=\"filter-area\">\r\n\t\t\t筛选区域\r\n\t\t</view>\r\n\t\t<view class=\"main-content\">\r\n\t\t\t<cover-view :style=\"thumbnailStyle\" class=\"thumbnail-box\">\r\n\t\t\t\t<cover-image :src=\"tempFilePath\" class=\"thumbnail-img\"></cover-image>\r\n\t\t\t\t<cover-view :style=\"visibleAreaStyle\" class=\"visible-area\"></cover-view>\r\n\t\t\t</cover-view>\r\n\t\t\t<view class=\"canvas-area\" :style=\"canvasStyle\">\r\n\t\t\t\t<view :style=\"canvasStyle\" class=\"canvas-wrapper\">\r\n\t\t\t\t\t<canvas class=\"canvas-box\" :style=\"canvasStyle\" id=\"myCanvas\" canvas-id=\"myCanvas\"\r\n\t\t\t\t\t\t@touchstart=\"onCanvasTouchStart\" @touchmove=\"onCanvasTouchMove\"\r\n\t\t\t\t\t\t@touchend=\"onCanvasTouchEnd\"></canvas>\r\n\t\t\t\t\t<cover-view v-if=\"isShowSeatImg\" class=\"seat-view\" :style=\"seatPosition\">\r\n\t\t\t\t\t\t<cover-view class=\"seat-toast-content\">\r\n\t\t\t\t\t\t\t<cover-image class=\"seat-img\" :src=\"imgUrl\" alt=\"\"></cover-image>\r\n\t\t\t\t\t\t\t<cover-view class=\"blank-space\">\r\n\t\t\t\t\t\t\t\t<cover-view class=\"seat\">1楼</cover-view>\r\n\t\t\t\t\t\t\t\t<cover-view class=\"divider\"></cover-view>\r\n\t\t\t\t\t\t\t\t<cover-view class=\"seat\">10排</cover-view>\r\n\t\t\t\t\t\t\t\t<cover-view class=\"divider\"></cover-view>\r\n\t\t\t\t\t\t\t\t<cover-view class=\"seat\">20座</cover-view>\r\n\t\t\t\t\t\t\t</cover-view>\r\n\t\t\t\t\t\t</cover-view>\r\n\t\t\t\t\t\t<cover-image class=\"seat-anchor\" src=\"/static/triangle-down.png\"></cover-image>\r\n\t\t\t\t\t</cover-view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<canvas v-if=\"isShowTemp\" class=\"temp-canvas-box\" :style=\"tempStyle\" id=\"tempCanvas\"\r\n\t\t\t\tcanvas-id=\"tempCanvas\"></canvas>\r\n\t\t</view>\r\n\t\t<view class=\"footer-area\">\r\n\t\t\t<view class=\"btn\" @click=\"zoomIn(0.2)\">放大</view>\r\n\t\t\t<view class=\"btn\" @click=\"zoomOut(0.2)\">缩小</view>\r\n\t\t\t<view class=\"btn\" @click=\"reset\">还原</view>\r\n\t\t</view>\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n// import {\r\n// \tseatInfo\r\n// } from './seatData.js'\r\nimport {\r\n\tseatInfo\r\n} from './seatNew.js'\r\nimport {\r\n\tthrottle\r\n} from 'lodash'\r\nimport CanvasBase from './utils/canvas.js'\r\n\r\nlet initialDistance = 0;\r\nlet seatInfoList = seatInfo.datas;\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcanvasContainerBox: { // 画布容器盒子宽高\r\n\t\t\t\twidth: 700,\r\n\t\t\t\theight: 700\r\n\t\t\t},\r\n\t\t\tscaleBase: 1, // 初始基础缩放\r\n\t\t\tscale: 1,  // 实时缩放\r\n\t\t\tpreScale: 1, // 上一次缩放\r\n\t\t\tbaseXPoint: 0, // 基础x坐标偏移\r\n\t\t\tbaseYPoint: 0, // 基础y坐标偏移\r\n\t\t\tcanvasClass: null, // 自定义canvas实例\r\n\t\t\tmaxScale: 1, // 最大缩放\r\n\t\t\tminScale: 0.1, // 最小缩放\r\n\t\t\tscaleStep: 0.02, // 每次缩放步长\r\n\t\t\toffset: { // 画布绘制前偏移\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t},\r\n\t\t\tcurOffset: { // 绘制后的当前偏移\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t},\r\n\t\t\tmousePos: { // 中心点放大还是参照鼠标位置放大 【目前统一按照中心点放大】\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t},\r\n\t\t\tisLoading: true, // canvas loading\r\n\t\t\twidthRatio: 1, // 左右 宽度偏移比例\r\n\t\t\theightRatio: 1, // 上下 高度偏移比例\r\n\t\t\tstartX: 0, // 手指触摸开始x坐标\r\n\t\t\tstartY: 0, // 手指触摸开始y坐标\r\n\t\t\tcanvasStyle: 'width: 400px; height: 400px; ', // 画布样式\r\n\t\t\ttempStyle: '', // 临时画布样式\r\n\t\t\timgUrl: 'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fsafe-img.xhscdn.com%2Fbw1%2F35a87c2e-fd4b-4d46-92d8-58886d5caeea%3FimageView2%2F2%2Fw%2F1080%2Fformat%2Fjpg&refer=http%3A%2F%2Fsafe-img.xhscdn.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1705415354&t=743620e4a460804f9783ad939be4912d',\r\n\t\t\tseatPosition: '', // 座位视角定位\r\n\t\t\tisShowSeatImg: false, // 座位视角是否显示\r\n\t\t\tcurSelectSeat: null, // 当前选中的座位的信息\r\n\t\t\tthumbnailInfo: { // 缩略图信息\r\n\t\t\t\twidth: 200,\r\n\t\t\t\theight: 200,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tchangeWidth: 0,\r\n\t\t\t\tchangeHeight: 0\r\n\t\t\t},\r\n\t\t\tinnerBoxInitInfo: { // 初始缩略图内部box信息\r\n\t\t\t\twidth: 200,\r\n\t\t\t\theight: 200\r\n\t\t\t},\r\n\t\t\tthumbnailStyle: '',  // 缩略图样式\r\n\t\t\tisShowCanvas: false,\r\n\t\t\tvisibleAreaStyle: '', // 缩略图可视区域【小矩形】样式\r\n\t\t\tcanvasInitInfo: { // 缩放后的画布信息\r\n\t\t\t\twidth: 400,\r\n\t\t\t\theight: 400\r\n\t\t\t},\r\n\t\t\tthumbnailScale: 1, // 缩略图缩放比例\r\n\t\t\tseatBoxHeight: 330, // 座位视角盒子高度\r\n\t\t\tisTouchMoving: false, // 是否正在移动\r\n\t\t\tcanvasType: '', // 当前canvas类型 cache(缓存资源:伪离屏canvas) || target(目标)\r\n\t\t\ttempFilePath: '', // 临时画布资源图片路径\r\n\t\t\tisShowTemp: true, // 是否显示缓存canvas\r\n\t\t\tboundary: {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: 0\r\n\t\t\t},\r\n\t\t\tisCancelDraw: false,\r\n\t\t\tdiffOffsetY: 0, // 画布与真实座位中间的差值\r\n\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\r\n\t},\r\n\tonReady() {\r\n\r\n\t},\r\n\r\n\tmounted() {\r\n\r\n\t\t// 动态获取画布容器盒子宽高\r\n\t\tuni.createSelectorQuery().select('.main-content').boundingClientRect((rect) => {\r\n\t\t\tconst width = parseInt(rect.width)\r\n\t\t\tconst height = parseInt(rect.height)\r\n\t\t\tthis.canvasContainerBox = {\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t}\r\n\t\t\tthis.init()\r\n\t\t}).exec();\r\n\t},\r\n\tmethods: {\r\n\t\t// 导出缩略图\r\n\t\texportThumbnail() {\r\n\t\t\t// tempCanvas 作为离屏canvas\r\n\t\t\tconst tempCtx = uni.createCanvasContext('tempCanvas', this);\r\n\t\t\tthis.canvasContext = tempCtx;\r\n\t\t\t// tempCtx.setLineWidth(4)\r\n\t\t\tthis.canvasType = 'cache'\r\n\t\t\tthis.userDraw()\r\n\r\n\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\tcanvasId: 'tempCanvas',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tthis.tempFilePath = res.tempFilePath;\r\n\r\n\t\t\t\t\tconst diffOffset = 3;\r\n\t\t\t\t\tconst width = this.innerBoxInitInfo.width - diffOffset;\r\n\t\t\t\t\tconst height = this.innerBoxInitInfo.height - diffOffset;\r\n\t\t\t\t\tthis.visibleAreaStyle =\r\n\t\t\t\t\t\t`width: ${width}px; height: ${height}px;`;\r\n\t\t\t\t\tthis.innerBoxInitInfo = {\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\t// 初始化数据\r\n\t\tinitData() {\r\n\t\t\tconst rectCanvas = this.calculateBoundingRectangle()\r\n\t\t\tthis.canvasInfo = rectCanvas;\r\n\t\t\tconst {\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t} = rectCanvas\r\n\t\t\tthis.baseXPoint = x;\r\n\t\t\tthis.baseYPoint = y;\r\n\t\t\tlet scale = 1;\r\n\t\t\tscale = +(this.canvasContainerBox.width / width).toFixed(2)\r\n\t\t\tthis.scaleBase = scale;\r\n\t\t\tthis.scale = scale;\r\n\t\t\tthis.preScale = scale;\r\n\t\t\tthis.minScale = scale;\r\n\t\t\tthis.maxScale = 1;\r\n\t\t\tthis.widthRatio = 2;\r\n\t\t\tthis.heightRatio = 2;\r\n\t\t},\r\n\r\n\t\t// 计算画布边界\r\n\t\tcalculateBoundingRectangle() {\r\n\t\t\tlet minX = Infinity;\r\n\t\t\tlet minY = Infinity;\r\n\t\t\tlet maxX = -Infinity;\r\n\t\t\tlet maxY = -Infinity;\r\n\t\t\tconst data = seatInfo.datas\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\tconst item = data[i];\r\n\t\t\t\tconst x = item.p.location.x;\r\n\t\t\t\tconst y = item.p.location.y;\r\n\t\t\t\tif (!item.p.width) {\r\n\t\t\t\t\t// console.log(item)\r\n\t\t\t\t}\r\n\t\t\t\tif (!item.p.height) {\r\n\t\t\t\t\t// console.log(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst width = item.p.width || 0;\r\n\t\t\t\tconst height = item.p.height || 0;\r\n\t\t\t\tminX = Math.min(minX, x);\r\n\t\t\t\tminY = Math.min(minY, y);\r\n\t\t\t\tmaxX = Math.max(maxX, x + width);\r\n\t\t\t\tmaxY = Math.max(maxY, y + height);\r\n\t\t\t}\r\n\r\n\t\t\tconst width = maxX - minX;\r\n\t\t\tconst height = maxY - minY;\r\n\t\t\treturn {\r\n\t\t\t\tx: minX,\r\n\t\t\t\ty: minY,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 初始化页面\r\n\t\tasync init() {\r\n\t\t\tthis.initData()\r\n\t\t\tthis.tempStyle = `width: ${this.canvasInfo.width}px; height: ${this.canvasInfo.height}px;`\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.exportThumbnail()\r\n\t\t\t\tthis.startTargetCanvas()\r\n\t\t\t\tthis.isShowTemp = false;\r\n\t\t\t\tthis.isLoading = false;\r\n\t\t\t}, 300)\r\n\r\n\t\t},\r\n\r\n\t\t// 开始绘制目标canvas\r\n\t\tstartTargetCanvas() {\r\n\t\t\tlet width = Math.round(this.canvasInfo.width * this.scale)\r\n\t\t\tlet height = Math.round(this.canvasInfo.height * this.scale)\r\n\t\t\t// 反推原数据偏移\r\n\t\t\tthis.diffOffsetY = (this.canvasContainerBox.height - height) / 2\r\n\t\t\tthis.baseYPoint -= this.diffOffsetY / this.scale;\r\n\r\n\t\t\tthis.boundary = {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: width,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: height\r\n\t\t\t}\r\n\t\t\tthis.canvasInitInfo = {\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t}\r\n\t\t\tconst thumbnailScale = this.canvasInitInfo.width / this.thumbnailInfo.width;\r\n\t\t\tthis.thumbnailScale = thumbnailScale\r\n\r\n\r\n\t\t\tthis.thumbnailInfo.width = this.thumbnailInfo.width;\r\n\t\t\tthis.thumbnailInfo.height = this.canvasInitInfo.height / thumbnailScale;\r\n\t\t\tthis.thumbnailStyle =\r\n\t\t\t\t`width: ${this.thumbnailInfo.width}px; height: ${this.thumbnailInfo.height}px; `\r\n\t\t\tlet style = `width: ${width}px; height: ${this.canvasContainerBox.height}px;`\r\n\t\t\tthis.canvasStyle = style;\r\n\t\t\tconst ctx = uni.createCanvasContext('myCanvas', this);\r\n\t\t\tthis.canvasContext = ctx;\r\n\t\t\tthis.canvasType = 'target'\r\n\t\t\t// 生成自定义canvas实例\r\n\t\t\tconst canvasBase = new CanvasBase({\r\n\t\t\t\tctx\r\n\t\t\t})\r\n\t\t\tthis.canvasClass = canvasBase;\r\n\t\t\tthis.draw()\r\n\t\t\tthis.isShowCanvas = true;\r\n\t\t},\r\n\t\t// 重新绘制\r\n\t\tdraw() {\r\n\t\t\tthis.canvasClass.reset()\r\n\t\t\tthis.clearCanvas();\r\n\t\t\tif (this.scale === this.scaleBase) {\r\n\t\t\t\tthis.canvasContext.translate(0, 0);\r\n\t\t\t\tthis.canvasContext.scale(this.scale, this.scale);\r\n\t\t\t\t// this.canvasContext.setLineWidth(4); // 设置边框宽度\r\n\t\t\t\tthis.userDraw();\r\n\r\n\t\t\t\t// 缩略图\r\n\t\t\t\tthis.thumbnailInfo.top = 0;\r\n\t\t\t\tthis.thumbnailInfo.left = 0;\r\n\t\t\t\tthis.thumbnailInfo.changeWidth = this.thumbnailInfo.width;\r\n\t\t\t\tthis.thumbnailInfo.changeHeight = this.thumbnailInfo.height;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.canvasContext.translate(this.offset.x, this.offset.y);\r\n\t\t\t\tthis.canvasContext.scale(this.scale, this.scale);\r\n\t\t\t\t// this.canvasContext.setLineWidth(4); // 设置边框宽度\r\n\t\t\t\tif (this.isTouchMoving) {\r\n\t\t\t\t\tif (this.tempFilePath) {\r\n\t\t\t\t\t\tconsole.log('缩略图绘制')\r\n\t\t\t\t\t\tthis.canvasContext.drawImage(this.tempFilePath, 0, this.diffOffsetY / this.scaleBase * (this\r\n\t\t\t\t\t\t\t.scale /\r\n\t\t\t\t\t\t\tthis.preScale),\r\n\t\t\t\t\t\t\tthis.canvasInfo\r\n\t\t\t\t\t\t\t\t.width, this.canvasInfo\r\n\t\t\t\t\t\t\t.height);\r\n\t\t\t\t\t\tthis.canvasContext.draw()\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('重新绘制1')\r\n\t\t\t\t\t\tthis.userDraw();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('重新绘制2')\r\n\t\t\t\t\tthis.userDraw();\r\n\t\t\t\t}\r\n\t\t\t\t// 视角弹窗定位\r\n\t\t\t\tif (this.curSelectSeat) {\r\n\t\t\t\t\tconst config = this.curSelectSeat\r\n\t\t\t\t\tconst left = config.x * this.scale + this.offset.x + 'px'\r\n\t\t\t\t\tconst top = config.y * this.scale + this.offset.y - config.radius * this.scale - this.seatBoxHeight + 'px'\r\n\t\t\t\t\tthis.seatPosition = `left: ${left}; top: ${top};`\r\n\t\t\t\t}\r\n\t\t\t\t// 缩略图展示\r\n\t\t\t\tthis.drawThumbnail()\r\n\t\t\t}\r\n\r\n\t\t\tconst overLayoutInfo = this.isOverLayout()\r\n\t\t\tif (overLayoutInfo.left) {\r\n\t\t\t\tthis.thumbnailInfo.left = 0\r\n\t\t\t}\r\n\t\t\tif (overLayoutInfo.right) {\r\n\t\t\t\tthis.thumbnailInfo.left = this.thumbnailInfo.width - this.thumbnailInfo.changeWidth\r\n\t\t\t}\r\n\t\t\tif (overLayoutInfo.top) {\r\n\t\t\t\tthis.thumbnailInfo.top = 0\r\n\t\t\t}\r\n\t\t\tif (overLayoutInfo.bottom) {\r\n\t\t\t\tthis.thumbnailInfo.top = this.thumbnailInfo.height - this.thumbnailInfo.changeHeight\r\n\t\t\t}\r\n\t\t\tconst changeStyle =\r\n\t\t\t\t`width: ${this.thumbnailInfo.changeWidth}px; height:${this.thumbnailInfo.changeHeight}px; `\r\n\t\t\tthis.visibleAreaStyle =\r\n\t\t\t\t`${changeStyle} left:${this.thumbnailInfo.left}px; top:${this.thumbnailInfo.top}px;`\r\n\r\n\t\t},\r\n\t\t// 缩略图展示\r\n\t\tdrawThumbnail() {\r\n\t\t\t// 缩略图展示\r\n\t\t\tconst {\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t} = this.thumbnailInfo;\r\n\t\t\tconst diffScale = this.scale / this.scaleBase;\r\n\t\t\tconst _changeWidth = width / diffScale;\r\n\t\t\tconst _changeHeight = this.canvasContainerBox.height / this.thumbnailScale / diffScale;\r\n\t\t\tthis.thumbnailInfo.left = -this.offset.x / this.thumbnailScale / diffScale;\r\n\t\t\tthis.thumbnailInfo.changeWidth = _changeWidth > width ? width : _changeWidth;\r\n\r\n\t\t\t// 多出来的空余高度比例\r\n\t\t\tconst offsetScale = this.diffOffsetY / this.canvasContainerBox.height\r\n\t\t\tconst thumbnailOffsetHeight = offsetScale * (height / (1 - offsetScale * 2));\r\n\t\t\tthis.thumbnailInfo.top = -thumbnailOffsetHeight + -(this.offset.y) / this.thumbnailScale / diffScale;\r\n\t\t\tthis.thumbnailInfo.changeHeight = _changeHeight > height ? height : _changeHeight;\r\n\r\n\t\t},\r\n\r\n\t\tisOverLayout() {\r\n\t\t\tconst {\r\n\t\t\t\tleft,\r\n\t\t\t\ttop,\r\n\t\t\t\tchangeWidth,\r\n\t\t\t\tchangeHeight,\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t} = this.thumbnailInfo;\r\n\t\t\tconst offsetInfo = {\r\n\t\t\t\tleft: left < 0,\r\n\t\t\t\tright: left + changeWidth > width,\r\n\t\t\t\ttop: top < 0,\r\n\t\t\t\tbottom: top + changeHeight > height\r\n\t\t\t}\r\n\t\t\treturn offsetInfo\r\n\t\t},\r\n\r\n\t\t// 放大\r\n\t\tzoomIn(step) {\r\n\t\t\tthis.scale += step ? step : this.scaleStep;\r\n\t\t\tthis.scale = +this.scale.toFixed(2)\r\n\t\t\tif (this.scale > this.maxScale) {\r\n\t\t\t\tthis.scale = this.maxScale;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.zoom.call(this);\r\n\t\t},\r\n\r\n\t\t// 缩小\r\n\t\tzoomOut(step) {\r\n\t\t\tthis.scale -= step ? step : this.scaleStep;\r\n\t\t\tthis.scale = +this.scale.toFixed(2)\r\n\r\n\t\t\tif (this.scale < this.minScale) {\r\n\t\t\t\tthis.scale = this.minScale;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.zoom.call(this);\r\n\t\t},\r\n\r\n\t\tzoom() {\r\n\t\t\t// 是否居中放大\r\n\t\t\tthis.mousePos.x = this.canvasInitInfo.width / 2;\r\n\t\t\tthis.mousePos.y = this.canvasContainerBox.height / 2;\r\n\t\t\t// 放大系数：this.scale / this.preScale =>n\r\n\t\t\t// 先偏移后缩放：offsetX = x*n-x;  偏移为：-offsetX\r\n\t\t\tthis.offset.x = this.mousePos.x - ((this.mousePos.x - this.offset.x) * this.scale) / this.preScale;\r\n\t\t\tthis.offset.y = this.mousePos.y - ((this.mousePos.y - this.offset.y) * this.scale) / this.preScale;\r\n\t\t\tthis.draw();\r\n\t\t\tthis.preScale = this.scale;\r\n\t\t\tthis.curOffset.x = this.offset.x;\r\n\t\t\tthis.curOffset.y = this.offset.y;\r\n\t\t},\r\n\t\tclearCanvas() {\r\n\t\t\tthis.canvasContext.clearRect(0, 0, this.canvasInitInfo.width, this.canvasInitInfo.height);\r\n\t\t},\r\n\t\t// 还原\r\n\t\treset() {\r\n\t\t\tthis.clear();\r\n\t\t\tthis.draw();\r\n\t\t},\r\n\t\t// 清除地图并还原对象所有设置\r\n\t\tclear() {\r\n\t\t\tthis.clearCanvas();\r\n\t\t\tthis.scale = this.scaleBase; // 当前缩放\r\n\t\t\tthis.preScale = this.scaleBase; // 当前缩放\r\n\t\t\tthis.offset = {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t}; // 拖动偏移\r\n\t\t\tthis.curOffset = {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t}; // 当前偏移\r\n\t\t\tthis.mousePos = { // 中心点放大还是参照鼠标位置放大 【目前统一按照中心点放大】\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// 用户绘制逻辑\r\n\t\tuserDraw(isDraw = true) {\r\n\t\t\tseatInfoList.forEach((item) => {\r\n\t\t\t\tconsole.log('==遍历中')\r\n\t\t\t\tlet type = 'seat'\r\n\t\t\t\tif (item.class.indexOf('StageNode') > -1) {\r\n\t\t\t\t\ttype = 'stage'\r\n\t\t\t\t}\r\n\t\t\t\tif (item.class.indexOf('RegionNode') > -1 && item.class.indexOf('ShapeRegionNode')) {\r\n\t\t\t\t\ttype = 'region'\r\n\t\t\t\t}\r\n\t\t\t\tif (item.class.indexOf('ShapeRegionNode') > -1) {\r\n\t\t\t\t\ttype = 'shapeRegion'\r\n\t\t\t\t}\r\n\t\t\t\tif (item.class.indexOf('RowNode') > -1) {\r\n\t\t\t\t\ttype = 'row'\r\n\t\t\t\t}\r\n\t\t\t\tif (item.class.indexOf('SeatNode') > -1) {\r\n\t\t\t\t\ttype = 'seat'\r\n\t\t\t\t}\r\n\t\t\t\tif (type === 'stage') {\r\n\t\t\t\t\tthis.handleStage(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'region') {\r\n\t\t\t\t\tthis.handleRegion(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'shapeRegion') {\r\n\t\t\t\t\tthis.handleShapeRegion(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'row') {\r\n\t\t\t\t\tthis.handleRow(item)\r\n\t\t\t\t}\r\n\t\t\t\tif (type === 'seat') {\r\n\t\t\t\t\tthis.handleSeat(item)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tisDraw && this.canvasContext.draw();\r\n\t\t\tconsole.log('绘制结束')\r\n\t\t},\r\n\t\t// 绘制矩形\r\n\t\tdrawRectangle(payload) {\r\n\t\t\tconst {\r\n\t\t\t\tcontext,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t} = payload;\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.setStrokeStyle('black'); // 设置边框颜色\r\n\t\t\tcontext.rect(x, y, width, height);\r\n\t\t\tcontext.closePath();\r\n\t\t\tcontext.stroke();\r\n\r\n\t\t},\r\n\t\t// 绘制文本\r\n\t\tdrawText(payload) {\r\n\t\t\tconst {\r\n\t\t\t\tcontext,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tname\r\n\t\t\t} = payload;\r\n\t\t\tcontext.beginPath()\r\n\t\t\tcontext.setTextAlign('center');\r\n\t\t\tcontext.setTextBaseline('middle');\r\n\t\t\tcontext.setFillStyle('black');\r\n\t\t\tcontext.fillText(name, x, y);\r\n\t\t\tcontext.closePath()\r\n\r\n\t\t},\r\n\t\t// 绘制圆形\r\n\t\tdrawCircle(payload) {\r\n\t\t\tconst {\r\n\t\t\t\tcontext,\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tradius,\r\n\t\t\t\tisFill,\r\n\t\t\t\tinfo\r\n\t\t\t} = payload;\r\n\t\t\tconst angle = info.angle;\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.setStrokeStyle('black')\r\n\t\t\tcontext.arc(x, y, radius, 0, 2 * Math.PI);\r\n\t\t\tif (isFill) {\r\n\r\n\t\t\t\tlet curColor = angle && angle.picture ? '#CF3B34' : '#C8C8C8'\r\n\t\t\t\tcontext.setStrokeStyle(curColor); // 设置边框颜色\r\n\t\t\t\tcontext.arc(x, y, radius, 0, 2 * Math.PI)\r\n\t\t\t\tcontext.closePath()\r\n\t\t\t\tcontext.setFillStyle(curColor);\r\n\t\t\t\t// context.closePath();\r\n\t\t\t\t// context.setFillStyle('white');\r\n\t\t\t\tcontext.fill();\r\n\t\t\t}\r\n\t\t\tcontext.stroke()\r\n\r\n\t\t},\r\n\t\t// 绘制多边形\r\n\t\tdrawPolygon(info) {\r\n\t\t\tconst {\r\n\t\t\t\tcontext,\r\n\t\t\t\tpoints\r\n\t\t\t} = info\r\n\t\t\tif (points.length < 3) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.moveTo(points[0].x, points[0].y);\r\n\r\n\t\t\tfor (let i = 1; i < points.length; i++) {\r\n\t\t\t\tcontext.lineTo(points[i].x, points[i].y);\r\n\t\t\t}\r\n\t\t\tcontext.setStrokeStyle('black')\r\n\t\t\tcontext.closePath();\r\n\t\t\tcontext.stroke()\r\n\r\n\t\t},\r\n\t\thandleRegion(info) {\r\n\t\t\tconst style = info.s\r\n\t\t\tconst position = info.p\r\n\t\t\tif (style['vector.shape'] && style['vector.shape'] === 'rectangle') {\r\n\t\t\t\tthis.drawRectangle({\r\n\t\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\t\tx: position.location.x - this.baseXPoint,\r\n\t\t\t\t\ty: position.location.y - this.baseYPoint,\r\n\t\t\t\t\twidth: position.width,\r\n\t\t\t\t\theight: position.height,\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tif (style['vector.shape'] && style['vector.shape'] === 'circle') {\r\n\t\t\t\tthis.drawCircle({\r\n\t\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\t\tx: position.location.x - this.baseXPoint + position.width / 2,\r\n\t\t\t\t\ty: position.location.y - this.baseYPoint + position.height / 2,\r\n\t\t\t\t\tradius: position.height / 2,\r\n\t\t\t\t\tisFill: false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 处理座位\r\n\t\thandleSeat(info) {\r\n\t\t\tconst position = info.p;\r\n\t\t\tconst circleInfo = {\r\n\t\t\t\tradius: position.height / 2,\r\n\t\t\t\tx: position.location.x - this.baseXPoint,\r\n\t\t\t\ty: position.location.y - this.baseYPoint,\r\n\t\t\t\tinfo: {\r\n\t\t\t\t\tc: info.c,\r\n\t\t\t\t\tisSelect: info.isSelect,\r\n\t\t\t\t\tangle: info.angle\r\n\t\t\t\t},\r\n\t\t\t\tisFill: true\r\n\t\t\t}\r\n\t\t\tif (this.canvasType === 'target') {\r\n\t\t\t\tconst circleInstance = this.canvasClass.circle(circleInfo)\r\n\t\t\t\tcircleInstance.on('touchend', (shapeInfo) => {\r\n\t\t\t\t\tconst originData = shapeInfo.config.info\r\n\t\t\t\t\tconst angle = originData.angle\r\n\t\t\t\t\t// 有图片才点击\r\n\t\t\t\t\tif (angle && angle.picture) {\r\n\t\t\t\t\t\tif (originData.c) {\r\n\t\t\t\t\t\t\tfor (let i = 0; i < seatInfoList.length; i++) {\r\n\t\t\t\t\t\t\t\tconst item = seatInfoList[i]\r\n\t\t\t\t\t\t\t\tif (JSON.stringify(originData.c) === JSON.stringify(item.c)) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('===命中了')\r\n\t\t\t\t\t\t\t\t\tseatInfoList[i].isSelect = !seatInfoList[i].isSelect;\r\n\t\t\t\t\t\t\t\t\tif (seatInfoList[i].isSelect) {\r\n\t\t\t\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\t\t\t\tconfig\r\n\t\t\t\t\t\t\t\t\t\t} = shapeInfo\r\n\t\t\t\t\t\t\t\t\t\tthis.curSelectSeat = config\r\n\t\t\t\t\t\t\t\t\t\tconst left = config.x * this.scale + this.offset.x + 'px'\r\n\t\t\t\t\t\t\t\t\t\tconst top = config.y * this.scale + this.offset.y - config.radius * this\r\n\t\t\t\t\t\t\t\t\t\t\t.scale - this.seatBoxHeight + 'px'\r\n\t\t\t\t\t\t\t\t\t\tthis.seatPosition = `left: ${left}; top: ${top};`\r\n\t\t\t\t\t\t\t\t\t\tthis.isShowSeatImg = true;\r\n\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tthis.isShowSeatImg = false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tseatInfoList[i].isSelect = false\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.draw()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\t// 绘制圆形\r\n\t\t\t\tcircleInfo.context = this.canvasContext\r\n\t\t\t\tthis.drawCircle(circleInfo)\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\thandleShapeRegion(info) {\r\n\t\t\tconst position = info.p\r\n\t\t\tconst positionList = position.points;\r\n\t\t\tconst points = positionList.map((item) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: item.x - this.baseXPoint,\r\n\t\t\t\t\ty: item.y - this.baseYPoint\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.drawPolygon({\r\n\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\tpoints\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleStage(stageInfo) {\r\n\t\t\tconst StagePayload = {\r\n\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\tx: stageInfo.p.location.x - this.baseXPoint,\r\n\t\t\t\ty: stageInfo.p.location.y - this.baseYPoint,\r\n\t\t\t\twidth: stageInfo.p.width,\r\n\t\t\t\theight: stageInfo.p.height,\r\n\t\t\t}\r\n\t\t\tthis.drawRectangle(StagePayload)\r\n\t\t\tconst textInfo = {\r\n\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\tname: stageInfo.p.name,\r\n\t\t\t\tx: StagePayload.x + StagePayload.width / 2,\r\n\t\t\t\ty: StagePayload.y + StagePayload.height / 2\r\n\t\t\t}\r\n\t\t\tthis.drawText(textInfo)\r\n\t\t},\r\n\t\t// 处理row提示\r\n\t\thandleRow(info) {\r\n\t\t\tconst style = info.s\r\n\t\t\tconst position = info.p\r\n\t\t\tconst payload = {\r\n\t\t\t\tcontext: this.canvasContext,\r\n\t\t\t\tx: position.location.x - this.baseXPoint + (style['label.xoffset'] || 0),\r\n\t\t\t\ty: position.location.y - this.baseYPoint + (style['label.yoffset'] || 0),\r\n\t\t\t\tname: position.name\r\n\t\t\t}\r\n\t\t\tthis.drawText(payload)\r\n\t\t},\r\n\t\tonCanvasTouchStart(e) {\r\n\t\t\tthis.isTouchMoving = false\r\n\t\t\tif (e.touches.length >= 2) {\r\n\t\t\t\t// 计算两点之间的距离\r\n\t\t\t\tlet xMove = e.touches[0].x - e.touches[1].x;\r\n\t\t\t\tlet yMove = e.touches[0].y - e.touches[1].y;\r\n\t\t\t\tinitialDistance = Math.sqrt(xMove * xMove + yMove * yMove);\r\n\t\t\t} else {\r\n\t\t\t\tthis.startX = e.touches[0].x\r\n\t\t\t\tthis.startY = e.touches[0].y\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonCanvasTouchMove: function (e) {\r\n\t\t\tthis.isTouchMoving = true;\r\n\t\t\tif (e.touches.length >= 2) {\r\n\t\t\t\tlet xMove = e.touches[0].x - e.touches[1].x;\r\n\t\t\t\tlet yMove = e.touches[0].y - e.touches[1].y;\r\n\r\n\t\t\t\t// 新的触摸点间距离\r\n\t\t\t\tlet distance = Math.sqrt(xMove * xMove + yMove * yMove);\r\n\r\n\t\t\t\t// 计算新旧触摸点间距离差异, 得到缩放值\r\n\t\t\t\tconst scale = distance / initialDistance;\r\n\r\n\t\t\t\tif (scale >= 1) {\r\n\t\t\t\t\tthis.zoomIn()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.zoomOut()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinitialDistance = distance;\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// 初始无法拖动\r\n\t\t\t\tif (this.scaleBase === this.scale) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet offsetX = this.curOffset.x + (e.touches[0].x - this.startX) * this.widthRatio;\r\n\t\t\t\tlet offsetY = this.curOffset.y + (e.touches[0].y - this.startY) * this.heightRatio;\r\n\r\n\t\t\t\tthis.drawThumbnail()\r\n\t\t\t\tconst overLayoutInfo = this.isOverLayout()\r\n\r\n\r\n\t\t\t\tconst oldOffsetx = this.offset.x\r\n\t\t\t\tconst oldOffsety = this.offset.y\r\n\r\n\r\n\r\n\t\t\t\tif (overLayoutInfo.left) {\r\n\t\t\t\t\toffsetX = offsetX < oldOffsetx ? offsetX : oldOffsetx\r\n\t\t\t\t}\r\n\t\t\t\tif (overLayoutInfo.right) {\r\n\t\t\t\t\toffsetX = offsetX > oldOffsetx ? offsetX : oldOffsetx\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (overLayoutInfo.top) {\r\n\t\t\t\t\toffsetY = offsetY < oldOffsety ? offsetY : oldOffsety\r\n\t\t\t\t}\r\n\t\t\t\tif (overLayoutInfo.bottom) {\r\n\t\t\t\t\toffsetY = offsetY > oldOffsety ? offsetY : oldOffsety\r\n\t\t\t\t}\r\n\t\t\t\tthis.offset.x = offsetX\r\n\t\t\t\tthis.offset.y = offsetY\r\n\r\n\t\t\t\tthis.draw()\r\n\t\t\t}\r\n\t\t},\r\n\t\tonCanvasTouchEnd(e) {\r\n\r\n\t\t\tthis.isTouchMoving = false;\r\n\t\t\tif (this.scaleBase === this.scale) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (!this.isCancelDraw) {\r\n\t\t\t\tthis.curOffset.x = this.offset.x;\r\n\t\t\t\tthis.curOffset.y = this.offset.y;\r\n\t\t\t\tconsole.log('touchEnd重新绘制')\r\n\t\t\t\tthis.draw()\r\n\t\t\t}\r\n\t\t\tthis.isCancelDraw = false;\r\n\t\t\tthis.canvasClass.handleEvent(e, {\r\n\t\t\t\tcurOffset: this.curOffset,\r\n\t\t\t\tscale: this.scale\r\n\t\t\t})\r\n\r\n\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n\twidth: 100%;\r\n\theight: 100vh;\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\r\n\t.filter-area {\r\n\t\twidth: 100%;\r\n\t\theight: 100px;\r\n\t\tbackground-color: #F5F5F5;\r\n\t\tborder: 1px solid red;\r\n\t}\r\n\r\n\t.footer-area {\r\n\t\twidth: 100%;\r\n\t\theight: 50px;\r\n\t\tborder: 1px solid green;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-start;\r\n\t}\r\n\r\n\t.main-content {\r\n\t\twidth: 100%;\r\n\t\tflex: 1;\r\n\t\tbackground-color: #F5F5F5;\r\n\t\tposition: relative;\r\n\r\n\t\t.canvas-area {\r\n\t\t\tposition: absolute;\r\n\t\t}\r\n\t}\r\n\r\n\t.loading-mask {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground-color: #f8f8f8;\r\n\r\n\t\tcolor: red;\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 99999;\r\n\r\n\t\t.loading-text {\r\n\t\t\tposition: absolute;\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 50%;\r\n\t\t\ttransform: translate(-50%, -50%);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.content {\r\n\twidth: 750rpx;\r\n\theight: 600px;\r\n\tborder: 1px solid red;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tbackground-color: #f8f8f8;\r\n}\r\n\r\n.thumbnail-box {\r\n\twidth: 200px;\r\n\theight: 200px;\r\n\tbackground-color: rgba(0, 0, 0, 0.7);\r\n\tposition: absolute;\r\n\ttop: 0px;\r\n\tright: 3px;\r\n\tz-index: 200;\r\n\r\n\t.thumbnail-img {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.visible-area {\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t\tleft: 0;\r\n\t\tz-index: 100;\r\n\t\tborder: 2px solid red;\r\n\t}\r\n}\r\n\r\n.canvas-wrapper {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\toverflow: hidden;\r\n}\r\n\r\n.seat-view {\r\n\tposition: absolute;\r\n\twidth: 334px;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tz-index: 200;\r\n\ttransform: translateX(-50%);\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n\r\n\t.seat-toast-content {\r\n\t\tbackground-color: #fff;\r\n\t\tbox-shadow: 0px 6px 12px 2px rgba(0, 0, 0, 0.16);\r\n\t\tborder-radius: 20px 20px 20px 20px;\r\n\t}\r\n\r\n\r\n\t.seat-img {\r\n\t\twidth: 100%;\r\n\t\theight: 236px;\r\n\t\toverflow: hidden;\r\n\t\tborder-radius: 0px 0px 0px 0px;\r\n\t}\r\n\r\n\t.blank-space {\r\n\t\twidth: 100%;\r\n\t\theight: 80px;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\r\n\t\t.seat {\r\n\t\t\tflex: 1;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: center;\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #333;\r\n\t\t\ttext-align: center;\r\n\t\t\theight: 34px;\r\n\t\t\tfont-size: 24px;\r\n\t\t\tfont-family: PingFang SC, PingFang SC;\r\n\t\t\tfont-weight: 500;\r\n\t\t}\r\n\r\n\t\t.divider {\r\n\t\t\twidth: 0px;\r\n\t\t\theight: 22px;\r\n\t\t\topacity: 0.4;\r\n\t\t\tborder: 2px solid #999999;\r\n\t\t\tbackground-color: #ccc;\r\n\t\t}\r\n\t}\r\n\r\n\t// 三角形\r\n\t.seat-anchor {\r\n\t\twidth: 28px;\r\n\t\theight: 14px;\r\n\t\t// background: url('./img/triangle-down.png') no-repeat center / 100%;\r\n\t\tmargin: 0 auto;\r\n\t}\r\n}\r\n\r\n\r\n.canvas-box {\r\n\twidth: 750rpx;\r\n\theight: 800px;\r\n\tborder: 1px solid red;\r\n\r\n}\r\n\r\n.temp-canvas-box {\r\n\twidth: 400px;\r\n\theight: 400px;\r\n}\r\n\r\n.btn {\r\n\twidth: 50px;\r\n\theight: 30px;\r\n\tborder: 1px solid red;\r\n\tmargin-bottom: 10px;\r\n}\r\n</style>","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=57280228&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=57280228&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1706261939229\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}